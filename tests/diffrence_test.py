import polybool as pb


def test_diffrence():
    region_a = [
        (704.237624, 311.067429),
        (585.714469, 165.25985),
        (580.737459, -21.556226),
        (825.140768, -42.669151),
        (939.27375, 202.801646),
        (907.837171, 299.649899),
        (704.237624, 311.067429),
    ]

    region_b = [
        (594.128232, 182.178958),
        (756.152613, 106.844841),
        (746.79128, 86.711012),
        (578.739333, 91.188122),
        (578.55291, 84.190605),
        (675.400366, 81.61047),
        (672.301879, -34.693726),
        (679.299396, -34.880148),
        (682.397883, 81.424047),
        (743.575274, 79.794206),
        (690.277317, -34.836039),
        (696.624755, -37.787315),
        (734.822854, 44.367006),
        (846.894657, -7.741389),
        (849.845932, -1.393951),
        (737.77413, 50.714444),
        (762.500051, 103.893565),
        (874.571854, 51.78517),
        (877.52313, 58.132608),
        (783.385268, 101.90252),
        (829.5314, 201.151025),
        (923.669263, 157.381114),
        (926.620539, 163.728552),
        (832.482676, 207.498464),
        (877.836304, 305.042494),
        (871.488866, 307.99377),
        (826.135238, 210.449739),
        (764.596157, 239.06267),
        (797.371861, 309.554808),
        (791.024422, 312.506084),
        (743.402652, 210.083859),
        (649.930725, 253.54414),
        (646.97945, 247.196702),
        (740.451376, 203.736421),
        (709.151311, 136.418002),
        (597.079508, 188.526396),
        (594.128232, 182.178958),
    ]

    result = pb.difference(pb.Polygon([region_a]), pb.Polygon([region_b]))

    except_regions = [
        [
            675.400366,
            81.61047,
            672.4408303334106,
            -29.478076195610278,
            580.737459,
            -21.556226,
            583.5511371021976,
            84.05744610025226,
        ],
        [
            740.451376,
            203.736421,
            709.151311,
            136.418002,
            602.5570110522473,
            185.97960118147904,
            650.8542899179249,
            245.39507407951584,
        ],
        [
            743.575274,
            79.794206,
            691.9835873209179,
            -31.166288864492216,
            679.42723520405,
            -30.081600929612325,
            682.397883,
            81.424047,
        ],
        [
            756.152613,
            106.844841,
            746.79128,
            86.711012,
            583.7375595605662,
            91.0549631136196,
            585.714469,
            165.25985,
            598.0030719054093,
            180.37733011542642,
        ],
        [
            788.1671383234442,
            306.3607989421573,
            743.402652,
            210.083859,
            655.4082287926524,
            250.99734481081728,
            704.237624,
            311.067429,
        ],
        [
            842.3607722464934,
            -5.633334598303591,
            825.140768,
            -42.669151,
            699.4051468664002,
            -31.807404693520542,
            734.822854,
            44.367006,
        ],
        [
            868.631582013672,
            301.8484843849619,
            826.135238,
            210.449739,
            764.596157,
            239.06267,
            795.690622185566,
            305.93889425736796,
        ],
        [
            870.0379695163185,
            53.89322427623974,
            845.312047925573,
            0.7141031047644457,
            737.77413,
            50.714444,
            762.500051,
            103.893565,
        ],
        [
            919.1353780229957,
            159.48916845974182,
            872.9892453753997,
            60.24066236644512,
            783.385268,
            101.90252,
            829.5314,
            201.151025,
        ],
        [
            939.27375,
            202.801646,
            922.0866538910526,
            165.83660656925167,
            832.482676,
            207.498464,
            876.1550649764844,
            301.4265797506044,
            907.837171,
            299.649899,
        ],
    ]

    assert len(result.regions) == len(except_regions)

    for i in range(len(result.regions)):
        region = result.regions[i]
        except_region = except_regions[i]
        assert len(region) * 2 == len(except_region)

        for j in range(len(region)):
            assert region[j].x == except_region[j * 2]
            assert region[j].y == except_region[j * 2 + 1]
